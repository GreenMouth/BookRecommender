}
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
probs <- seq(0.8,0.1,-0.025)
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
probs
probs <- seq(0.8,0.1,-0.01)
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
probs
probs <- seq(0.8,0.1,-0.05)
probs
probs <- seq(0.8,0.1,-0.1)
probs
dofit(probs)
ef1n2(probs)
probs <- seq(0.8,0.1,-0.1)
ptm <- proc.time()
dofit(probs)
proc.time()-ptm
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
probs <- seq(0.2,0.1,-0.1)
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
probs <- seq(0.15,0.1,-0.01)
probs
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
debug(ef1n2)
ptm <- proc.time()
ef1n2(probs)
proc.time()-ptm
probs
m <- length(probs)
p <- vector(mode = "list", length=m)
p[[1]] <- polynomial(c(1-probs[1],probs[1]))
for (i in 2:length(probs)) {
p[[i]] <- p[[i-1]]*do.call("polynomial", list(c(1-probs[i],probs[i])))
}
co <- sapply(p, function(x) coefficients(x))
co <- sapply(co, function(x) c(x, rep(0,m+1-length(x))),simplify = FALSE)
s <- 1/(1:(2*m))
f <- list(length=m)
f
s
for (k in m:1) {
k1 = 0:m
f[[k]]<-sum(2*k1*co[[k]][k1+1]*s[k+k1])
for (i in 1:(2*(k-1))){
s[i] <- (1-probs[k])*s[i] + probs[k]*s[i+1]
}
}
f
prod(1-probs)
f <- c(prod(1-probs),f)
f
f <- c(prod(1-probs),unlist(f))
f
f
data.table(k=which.max(unlist(f)-1), f1=f[which.max(unlist(f))])
f <- list(length=m)
for (k in m:1) {
k1 = 0:m
f[[k]]<-sum(2*k1*co[[k]][k1+1]*s[k+k1])
for (i in 1:(2*(k-1))){
s[i] <- (1-probs[k])*s[i] + probs[k]*s[i+1]
}
}
f <- c(prod(1-probs),unlist(f))
f
data.table(k=which.max(unlist(f)-1), f1=f[which.max(unlist(f))])
data.table(k=which.max(unlist(f))-1, f1=f[which.max(unlist(f))])
ef1n2 <- function(probs) {
m <- length(probs)
p <- vector(mode = "list", length=m)
p[[1]] <- polynomial(c(1-probs[1],probs[1]))
for (i in 2:length(probs)) {
p[[i]] <- p[[i-1]]*do.call("polynomial", list(c(1-probs[i],probs[i])))
}
co <- sapply(p, function(x) coefficients(x))
co <- sapply(co, function(x) c(x, rep(0,m+1-length(x))),simplify = FALSE)
s <- 1/(1:(2*m))
f <- list(length=m)
for (k in m:1) {
k1 = 0:m
f[[k]]<-sum(2*k1*co[[k]][k1+1]*s[k+k1])
for (i in 1:(2*(k-1))){
s[i] <- (1-probs[k])*s[i] + probs[k]*s[i+1]
}
}
f <- c(prod(1-probs),unlist(f))
data.table(k=which.max(unlist(f))-1, f1=f[which.max(unlist(f))])
}
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
install.packages("shinydashboard")
runApp('goodbooks/scripts/shiny/BookRecommendation')
install.packages("RCurl")
runApp('goodbooks/scripts/shiny/BookRecommendation')
runApp('goodbooks/scripts/shiny/BookRecommendation')
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
?selectInput
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
?uiOutput()
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
?submitButton
runApp('goodbooks/scripts/shiny/BookRecommendation')
runApp('goodbooks/scripts/shiny/BookRecommendation')
runApp('goodbooks/scripts/shiny/BookRecommendation')
tt <- c("select_1", "select_2")
tt
strsplit(tt,"_")
strsplit(tt,"_")[2]
sapply(strsplit(tt,"_"), function(x) x[[1]][2]
)
sapply(strsplit(tt,"_"), function(x) x[[2]])
as.numeric(sapply(strsplit(tt,"_"), function(x) x[[2]]))
runApp('goodbooks/scripts/shiny/BookRecommendation')
runApp('goodbooks/scripts/shiny/BookRecommendation')
?unlist
ll <- list(a=NULL, b=2, c="c")
ll
unlist(ll)
unlist(as.character(ll))
runApp('goodbooks/scripts/shiny/BookRecommendation')
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
runApp('goodbooks/scripts/shiny/BookRecommendation')
devtools::install_github("stefanwilhelm/ShinyRatingInput")
library(ShinyRatingInput)
library(ShinyRatingInput)
install.packages("httpuv")
install.packages("httpuv")
library(ShinyRatingInput)
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
?ratingInput
runApp('goodbooks/scripts/shiny/BookRecommendation')
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
remove.packages("data.table")
install.packages("data.table")
install.packages("data.table")
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
install.packages("prettydoc")
install.packages("DT")
books
library(recommenderlab)
library(data.table)
library(dplyr)
library(ggplot2)
library(stringr)
library(DT)
library(knitr)
books <- fread('../input/books.csv')
ratings <- fread('../input/ratings.csv')
books
books %>% mutate(lang = factor(language_code)) %>% group_by(lang) %>% tally() %>% arrange(-n)
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(language,number_of_books)) + geom_bar()+coord_flip()
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(language,number_of_books)) + geom_bar(stat="identity")+coord_flip()
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(language,reorder(number_of_books))) + geom_bar(stat="identity")+coord_flip()
?reorder
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(language,reorder(number_of_books, -number_of_books))) + geom_bar(stat="identity")+coord_flip()
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=language)) + geom_bar(stat="identity")+coord_flip()
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("test")
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, log(number_of_books)),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),log(number_of_books), fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books), fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")
books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+guides(fill=FALSE)
books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+guides(fill=FALSE)```
books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB"))
books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB")) %>% group_by(language) %>% summarize(number_of_books = n())
books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+guides(fill=FALSE)
multiplot(p1,p2)
library(ggplot2)
install.packages("ggplot2")
install.packages("ggplot2")
library(grid)
library(gridExtra)
multiplot(p1,p2)
grid.arrange(p1, p2, ncol = 2, main = "Main title")
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+guides(fill=FALSE)
library(recommenderlab)
library(data.table)
library(dplyr)
library(ggplot2)
library(stringr)
library(DT)
library(knitr)
books <- fread('../input/books.csv')
ratings <- fread('../input/ratings.csv')
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
datatable(head(ratings,10), class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
glimpse(ratings)
datatable(head(books,5),  class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE, columnDefs = list(list(width = '200px', targets = c(8)),list(width = '300px', targets = c(10,11)))))
glimpse(books)
ratings[,N:=.N, .(user_id, book_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id, book_id) %>% mutate(n=n())
cat('Number of duplicate ratings: ', nrow(ratings[N>1]))
ratings<-ratings[N==1]
ratings[,N:=.N, .(user_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id) %>% mutate(n=n())
cat('Number of users who rated fewer than 3 books: ', uniqueN(ratings[N<=2, user_id]))
ratings<-ratings[N>2]
user_fraction <- 0.1
users <- unique(ratings$user_id)
sample_users <- sample(users, round(user_fraction*length(users)))
cat('Number of ratings (before): ', nrow(ratings))
ratings <- ratings[user_id %in% sample_users]
cat('Number of ratings (after): ', nrow(ratings))
ratings %>% ggplot(aes(x=rating)) + geom_bar(fill="darkgreen")
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="darkgreen") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen")
ratings %>% group_by(book_id) %>% summarize(number_of_ratings_per_book=n()) %>% ggplot(aes(number_of_ratings_per_book)) + geom_bar(fill="orange") + coord_cartesian(c(0,20))
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange")
books %>% ggplot(aes(books_count, average_rating))+ geom_point() + stat_smooth(method = "lm")+coord_cartesian(c(0,1000))
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+guides(fill=FALSE)
multiplot(p1,p2)
grid.arrange(p1, p2, ncol = 2, main = "Main title")
p1
p2
grid.arrange(p1,p2)
grid.arrange(p1,p2, nrow=2)
?grid.arrange
grid.arrange(p1,p2, nrow=2)
grid.arrange(p1,p2, ncol=2)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "eng-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("")+title("english excluded")+guides(fill=FALSE)
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+title("english included")+guides(fill=FALSE)
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+xlab("language")+title("english included")+guides(fill=FALSE)
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "eng-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
books %>% arrange(-average_rating) %>% top_n(10,wt = average_rating) %>% select(title, ratings_count, average_rating) %>% ggplot(aes(title, average_rating))+geom_bar(stat="identity")+coord_flip()
books %>% ggplot(aes(ratings_count, average_rating))+ geom_point() + stat_smooth(method = "lm") + coord_cartesian(c(0,1e+5))
books %>% arrange(-average_rating) %>% top_n(10,wt = average_rating) %>% select(title, ratings_count, average_rating) %>% kable()
books %>% arrange(-average_rating) %>% top_n(10,wt = average_rating) %>% select(title, ratings_count, average_rating) %>% datatable()
books %>% arrange(-average_rating) %>% top_n(10,wt = average_rating) %>% select(title, ratings_count, average_rating) %>% datatable(class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)+    scale_fill_brewer(palette="Set1")
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)+    scale_fill_brewer(palette="Set1")
grid.arrange(p1,p2, ncol=2)
ratings %>% ggplot(aes(x=rating), fill=rating) + geom_bar(fill="darkgreen")
ratings %>% ggplot(aes(x=rating), fill=rating) + geom_bar()
ratings %>% ggplot(aes(x=rating, fill=rating)) + geom_bar()
ratings %>% ggplot(aes(x=rating, fill=rating)) + geom_bar()
ratings %>% ggplot(aes(x=rating,group=rating)) + geom_bar()
ratings %>% ggplot(aes(x=rating,fill=rating)) + geom_bar()
ratings %>% ggplot(aes(x=rating,fill=rating)) + geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=rating,fill=rating)) + geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=rating,fill=rating)) + geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=rating,fill=rating))+geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings
str(ratings)
ratings %>% ggplot(aes(x=rating,fill=rating))+geom_bar()
ratings %>% ggplot(aes(x=rating,fill="green"))+geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=rating,fill="rating""))+geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=rating,fill="rating"))+geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=rating,fill=rating))+geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=factor(rating),fill=factor(rating)))+geom_bar() +     scale_fill_brewer(palette="YlOrRd")
ratings %>% ggplot(aes(x=factor(rating),fill=factor(rating)))+geom_bar() +     scale_fill_brewer(palette="YlGnBl")
ratings %>% ggplot(aes(x=factor(rating),fill=factor(rating)))+geom_bar() +     scale_fill_brewer(palette="YlGnBu")
ratings %>% ggplot(aes(x=rating,fill=factor(rating)))+geom_bar() +     scale_fill_brewer(palette="YlGnBu")+guides(fill=FALSE)
library(recommenderlab)
library(data.table)
library(dplyr)
library(ggplot2)
library(stringr)
library(DT)
library(knitr)
library(grid)
library(gridExtra)
books <- fread('../input/books.csv')
ratings <- fread('../input/ratings.csv')
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
datatable(head(ratings,10), class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
glimpse(ratings)
datatable(head(books,5),  class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE, columnDefs = list(list(width = '200px', targets = c(8)),list(width = '300px', targets = c(10,11)))))
glimpse(books)
ratings[,N:=.N, .(user_id, book_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id, book_id) %>% mutate(n=n())
cat('Number of duplicate ratings: ', nrow(ratings[N>1]))
ratings<-ratings[N==1]
ratings[,N:=.N, .(user_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id) %>% mutate(n=n())
cat('Number of users who rated fewer than 3 books: ', uniqueN(ratings[N<=2, user_id]))
ratings<-ratings[N>2]
user_fraction <- 0.1
users <- unique(ratings$user_id)
sample_users <- sample(users, round(user_fraction*length(users)))
cat('Number of ratings (before): ', nrow(ratings))
ratings <- ratings[user_id %in% sample_users]
cat('Number of ratings (after): ', nrow(ratings))
ratings %>% ggplot(aes(x=rating,fill=factor(rating)))+geom_bar() +     scale_fill_brewer(palette="YlGnBu")+guides(fill=FALSE)
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="darkgreen") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen")
ratings %>% group_by(book_id) %>% summarize(number_of_ratings_per_book=n()) %>% ggplot(aes(number_of_ratings_per_book)) + geom_bar(fill="orange") + coord_cartesian(c(0,20))
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange")
books %>% ggplot(aes(books_count, average_rating))+ geom_point() + stat_smooth(method = "lm")+coord_cartesian(c(0,1000))
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
books %>% arrange(-average_rating) %>% top_n(10,wt = average_rating) %>% select(title, ratings_count, average_rating) %>% datatable(class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
books %>% arrange(-ratings_count) %>% top_n(10,wt = ratings_count) %>% select(title, ratings_count, average_rating) %>% datatable(class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
books %>% ggplot(aes(ratings_count, average_rating))+ geom_point() + stat_smooth(method = "lm") + coord_cartesian(c(0,1e+5))
ratings %>% group_by(book_id) %>% summarize(m=mean(rating),n=n()) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
ratings %>% group_by(user_id) %>% summarize(m=mean(rating),n=n()) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books[,series:=str_extract(title, "\\(.*\\)")]
books[,series_number := as.numeric(str_sub(str_extract(series, ', #[0-9]+\\)$'),4,-2))]
books[,series_name := str_sub(str_extract(series, '\\(.*,'),2,-2)]
books[!is.na(series_name) & !is.na(series_number), .(.N,m=mean(average_rating)), series_name] %>% ggplot(aes(N,m))+geom_point()+stat_smooth(method="lm")
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, fill=factor(series_number)))+geom_bar(stat="summary")+coord_cartesian(ylim=c(1,5))
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
runApp('goodbooks/scripts/shiny/BookRecommendation')
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, fill=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(1,5))
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(1,5))
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=NULL)
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color="")
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=NULL)
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(fill=NULL,color=NULL)
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_violin()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books[,title_cleaned:=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*'))]
books[,title_length:=sapply(str_split(books$title_cleaned," "),length)] %>% ggplot(aes(title_length,average_rating)) + geom_point()+stat_smooth()
books %>% mutate(series = str_extract(title, "\\(.*\\)"))
books %>% mutate(series = str_extract(title, "\\(.*\\)"))
books %>% mutate(series = str_extract(title, "\\(.*\\)")) %>% head()
books <- books %>% mutate(series = str_extract(title, "\\(.*\\)"), series_number := as.numeric(str_sub(str_extract(series, ', #[0-9]+\\)$'),4,-2)))
books <- books %>% mutate(series = str_extract(title, "\\(.*\\)"), series_number = as.numeric(str_sub(str_extract(series, ', #[0-9]+\\)$'),4,-2)))
books
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% summarise(n=n(),m=mean(average_rating)) %>% ggplot(aes(N,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% summarise(n=n(),m=mean(average_rating)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books <- books %>% mutate(series = str_extract(title, "\\(.*\\)"), series_number = as.numeric(str_sub(str_extract(series, ', #[0-9]+\\)$'),4,-2)), series_name = str_sub(str_extract(series, '\\(.*,'),2,-2))
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% summarise(n=n(),m=mean(average_rating)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0) %>% group_by(series_name, series_number) %>% summarise(m=mean(average_rating)) %>% ungroup() %>% group_by(series_name) %>% summarise(n=n()) %>% filter(n==2) %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books %>% filter(!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0) %>% group_by(series_name, series_number) %>% summarise(m=mean(average_rating)) %>% ungroup() %>% group_by(series_name) %>% mutate(n=n()) %>% filter(n==2) %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books[!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0 , .(m=mean(average_rating)), .(series_name, series_number)][,N:=.N, series_name][N==2] %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books <- books %>% mutate(title_cleaned:=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length:=sapply(str_split(books$title_cleaned," "),length)) %>% ggplot(aes(title_length,average_rating)) + geom_point()+stat_smooth()
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=sapply(str_split(books$title_cleaned," "),length)) %>% ggplot(aes(title_length,average_rating)) + geom_point()+stat_smooth()
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=sapply(str_split(books$title_cleaned," "),length)) %>% ggplot(aes(title_length,average_rating)) + geom_point()+stat_smooth()
library(recommenderlab)
library(data.table)
library(dplyr)
library(ggplot2)
library(stringr)
library(DT)
library(knitr)
library(grid)
library(gridExtra)
books <- fread('../input/books.csv')
ratings <- fread('../input/ratings.csv')
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
datatable(head(ratings,10), class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
glimpse(ratings)
datatable(head(books,5),  class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE, columnDefs = list(list(width = '200px', targets = c(8)),list(width = '300px', targets = c(10,11)))))
glimpse(books)
ratings[,N:=.N, .(user_id, book_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id, book_id) %>% mutate(n=n())
cat('Number of duplicate ratings: ', nrow(ratings[N>1]))
ratings<-ratings[N==1]
ratings[,N:=.N, .(user_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id) %>% mutate(n=n())
cat('Number of users who rated fewer than 3 books: ', uniqueN(ratings[N<=2, user_id]))
ratings<-ratings[N>2]
user_fraction <- 0.1
users <- unique(ratings$user_id)
sample_users <- sample(users, round(user_fraction*length(users)))
cat('Number of ratings (before): ', nrow(ratings))
ratings <- ratings[user_id %in% sample_users]
cat('Number of ratings (after): ', nrow(ratings))
ratings %>% ggplot(aes(x=rating,fill=factor(rating)))+geom_bar() +     scale_fill_brewer(palette="YlGnBu")+guides(fill=FALSE)
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="darkgreen") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen")
ratings %>% group_by(book_id) %>% summarize(number_of_ratings_per_book=n()) %>% ggplot(aes(number_of_ratings_per_book)) + geom_bar(fill="orange") + coord_cartesian(c(0,20))
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange")
books %>% ggplot(aes(books_count, average_rating))+ geom_point() + stat_smooth(method = "lm")+coord_cartesian(c(0,1000))
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
books %>% arrange(-average_rating) %>% top_n(10,wt = average_rating) %>% select(title, ratings_count, average_rating) %>% datatable(class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
books %>% arrange(-ratings_count) %>% top_n(10,wt = ratings_count) %>% select(title, ratings_count, average_rating) %>% datatable(class="nowrap hover row-border", options = list(dom = 't',scrollX = TRUE, autoWidth=TRUE))
books %>% ggplot(aes(ratings_count, average_rating))+ geom_point() + stat_smooth(method = "lm") + coord_cartesian(c(0,1e+5))
ratings %>% group_by(book_id) %>% summarize(m=mean(rating),n=n()) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
ratings %>% group_by(user_id) %>% summarize(m=mean(rating),n=n()) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books <- books %>% mutate(series = str_extract(title, "\\(.*\\)"), series_number = as.numeric(str_sub(str_extract(series, ', #[0-9]+\\)$'),4,-2)), series_name = str_sub(str_extract(series, '\\(.*,'),2,-2))
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number) & series_number <= 2 & series_number > 0) %>% group_by(series_name, series_number) %>% summarise(m=mean(average_rating)) %>% ungroup() %>% group_by(series_name) %>% mutate(n=n()) %>% filter(n==2) %>% ggplot(aes(factor(series_number),m, color=factor(series_number)))+geom_boxplot()+coord_cartesian(ylim=c(3,5))+guides(color=FALSE)+labs(x="Volume of series",y="Average rating")
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=sapply(str_split(books$title_cleaned," "),length)) books %>% ggplot(aes(title_length,average_rating)) + geom_point()+stat_smooth()
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=sapply(str_split(books$title_cleaned," "),length))
books
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')))
head(books)
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=str_count(title_cleaned, " ")+1)
head(books)
books %>% ggplot(aes(title_length,average_rating)) + geom_point()+stat_smooth()
books <- books %>% mutate(subtitle=str_detect(books$title,':')*1, subtitle=factor(subtitle))
books %>% ggplot(aes(subtitle, average_rating, group=subtitle, color=subtitle)) + geom_boxplot()
books %>% ggplot(aes(title_length,average_rating, color=title_length)) + geom_boxplot()+stat_smooth()
books %>% ggplot(aes(title_length,average_rating, color=title_length, group=title_length)) + geom_boxplot()+stat_smooth()
books %>% ggplot(aes(title_length,average_rating, color=title_length, group=title_length)) + geom_boxplot()
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=str_count(title_cleaned, " ")+1)
books %>% ggplot(aes(factor(title_length),average_rating, color=title_length, group=title_length)) + geom_boxplot()
books %>% ggplot(aes(factor(title_length),average_rating, color=factor(title_length), group=title_length)) + geom_boxplot()
books %>% ggplot(aes(factor(title_length),average_rating, color=factor(title_length), group=title_length)) + geom_boxplot() + guides(color=FALSE)
books <- books %>% mutate(title_cleaned=str_trim(str_extract(title,'([0-9a-zA-Z]| |\'|,|\\.|\\*)*')), title_length=str_count(title_cleaned, " ")+1)
books %>% ggplot(aes(factor(title_length),average_rating, color=factor(title_length), group=title_length)) + geom_boxplot() + guides(color=FALSE)
books %>% ggplot(aes(factor(title_length),average_rating, color=factor(title_length), group=title_length)) + geom_boxplot() + guides(color=FALSE) + stat_smooth()
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating))
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% summarize(m=mean(m))%>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% summarize(m=mean(m))
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm")
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point()+stat_smooth(method="lm",se = FALSE)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=2)+stat_smooth(method="lm",se = FALSE)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3)+stat_smooth(method="lm",se = FALSE)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3, color="darkgreen")+stat_smooth(method="lm",se = FALSE)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3, color="darkgreen")+stat_smooth(method="lm",se = FALSE, color="orange")
books <- books %>% mutate(series = str_extract(title, "\\(.*\\)"), series_number = as.numeric(str_sub(str_extract(series, ', #[0-9]+\\)$'),4,-2)), series_name = str_sub(str_extract(series, '\\(.*,'),2,-2))
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3)+stat_smooth(method="lm",se = FALSE)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3)+stat_smooth(method="lm",se = FALSE, size=4)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3)+stat_smooth(method="lm",se = FALSE, size=3)
books %>% filter(!is.na(series_name) & !is.na(series_number)) %>% group_by(series_name) %>% summarise(n=n(),m=mean(average_rating)) %>% ungroup() %>% group_by(n) %>% summarize(m=mean(m)) %>% ggplot(aes(n,m))+geom_point(size=3)+stat_smooth(method="lm",se = FALSE, size=2)
?stat_smooth
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen", width=0.9)
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_bar(fill="darkgreen")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen", color="grey")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen", color="white")
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange",, color="white")
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange",, color="grey")
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange",, color="grey90")
ratings %>% group_by(book_id) %>% summarize(mean_book_rating=mean(rating)) %>% ggplot(aes(mean_book_rating))+geom_histogram(fill="orange",, color="grey30")
ratings %>% group_by(book_id) %>% summarize(number_of_ratings_per_book=n()) %>% ggplot(aes(number_of_ratings_per_book)) + geom_bar(fill="orange",color="black") + coord_cartesian(c(0,20))
ratings %>% group_by(book_id) %>% summarize(number_of_ratings_per_book=n()) %>% ggplot(aes(number_of_ratings_per_book)) + geom_bar(fill="orange",color="black", width=1) + coord_cartesian(c(0,20))
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen", color="black")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="darkgreen", color="white")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="green", color="white")
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="green", color="black")
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="green",color="black") + coord_cartesian(c(3,50))
ratings %>% ggplot(aes(x=rating,fill=factor(rating)))+geom_bar(color="black") +     scale_fill_brewer(palette="YlGnBu")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books)), color="black") + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books)), color="black") + geom_bar(stat="identity")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity", color="black")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity", color="black")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="deepskyblue3",color="black") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="deepskyblue2",color="black") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="aliceblue",color="black") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="cadetblue2",color="black") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="cadetblue3",color="black") + coord_cartesian(c(3,50))
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="cadetblue3", color="black")
ratings %>% group_by(book_id) %>% summarize(number_of_ratings_per_book=n()) %>% ggplot(aes(number_of_ratings_per_book)) + geom_bar(fill="orange",color="grey20", width=1) + coord_cartesian(c(0,20))
ratings %>% group_by(user_id) %>% summarize(mean_user_rating=mean(rating)) %>% ggplot(aes(mean_user_rating))+geom_histogram(fill="cadetblue3", color="grey20")
ratings %>% group_by(user_id) %>% summarize(number_of_ratings_per_user=n()) %>% ggplot(aes(number_of_ratings_per_user)) + geom_bar(fill="cadetblue3",color="grey20") + coord_cartesian(c(3,50))
ratings %>% ggplot(aes(x=rating,fill=factor(rating)))+geom_bar(color="grey20") +     scale_fill_brewer(palette="YlGnBu")+guides(fill=FALSE)
p2<-books %>% mutate(language = factor(language_code)) %>% filter(!language %in% c("en-US", "en-GB", "eng", "en-CA", "")) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language,number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity", color="grey20")+coord_flip()+labs(x="",title="english excluded")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
p1 <- books %>% mutate(language = factor(language_code)) %>% group_by(language) %>% summarize(number_of_books = n()) %>% arrange(-number_of_books) %>% ggplot(aes(reorder(language, number_of_books),number_of_books, fill=reorder(language, number_of_books))) + geom_bar(stat="identity", color="grey20")+coord_flip()+labs(x="language", title="english included")+guides(fill=FALSE)
grid.arrange(p1,p2, ncol=2)
shiny::runApp('goodbooks/scripts/shiny/BookRecommendation')
books <- fread('../input/books.csv')
ratings <- fread('../input/ratings.csv')
ratings[,N:=.N, .(user_id, book_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id, book_id) %>% mutate(n=n())
cat('Number of duplicate ratings: ', nrow(ratings[N>1]))
ratings<-ratings[N==1]
ratings[,N:=.N, .(user_id)]
## corresponding dplyr code
# ratings %>% group_by(user_id) %>% mutate(n=n())
cat('Number of users who rated fewer than 3 books: ', uniqueN(ratings[N<=2, user_id]))
ratings<-ratings[N>2]
fwrite(ratings, 'ratings_cleaned.csv')
fwrite(ratings, 'ratings_cleaned.csv')
dim(ratings)
user_fraction <- 0.2
users <- unique(ratings$user_id)
sample_users <- sample(users, round(user_fraction*length(users)))
cat('Number of ratings (before): ', nrow(ratings))
ratings <- ratings[user_id %in% sample_users]
cat('Number of ratings (after): ', nrow(ratings))
fwrite(ratings, 'ratings_cleaned_20.csv')
setwd("~/Desktop/Machine Learning/Kaggle/goodbooks/scripts/shiny/BookRecommendation")
fwrite(ratings, 'ratings_cleaned_20.csv')
runApp()
